# Schema에 SpringBatch 삭제 및 truncate방법 

## 방법 1

- 다음과 같이 연관관계를 확인하여 삭제한다. 
  
```
DELETE FROM BATCH_STEP_EXECUTION_CONTEXT WHERE STEP_EXECUTION_ID IN (SELECT BATCH_STEP_EXECUTION.STEP_EXECUTION_ID FROM BATCH_STEP_EXECUTION WHERE JOB_EXECUTION_ID IN (SELECT JOB_EXECUTION_ID FROM BATCH_JOB_EXECUTION WHERE STATUS IN ('COMPLETED','FAILED')));
DELETE FROM BATCH_STEP_EXECUTION WHERE JOB_EXECUTION_ID IN (SELECT JOB_EXECUTION_ID FROM BATCH_JOB_EXECUTION WHERE STATUS IN ('COMPLETED','FAILED'));
DELETE FROM BATCH_JOB_EXECUTION_CONTEXT WHERE JOB_EXECUTION_ID IN (SELECT JOB_EXECUTION_ID FROM BATCH_JOB_EXECUTION WHERE STATUS IN ('COMPLETED','FAILED'));
DELETE FROM BATCH_JOB_EXECUTION_PARAMS WHERE JOB_EXECUTION_ID IN (SELECT JOB_EXECUTION_ID FROM BATCH_JOB_EXECUTION WHERE STATUS IN ('COMPLETED','FAILED'));
DELETE FROM BATCH_JOB_EXECUTION WHERE STATUS IN ('COMPLETED','FAILED');
DELETE FROM BATCH_JOB_INSTANCE WHERE JOB_INSTANCE_ID NOT IN (SELECT BATCH_JOB_EXECUTION.JOB_INSTANCE_ID FROM BATCH_JOB_EXECUTION);
```

## 방법 2

- 다음 순서대로 truncate한다. 

```
truncate batch_step_execution_context;
truncate batch_step_execution;
truncate batch_job_execution_context;
truncate batch_job_execution;
truncate batch_job_params;
truncate batch_job_instance;
```

## 방법 3

- Foreign Key Constraint 를 해재하고 필요한 데이터 삭제후 옵션 원복하기. 

```
set foreign_key_checks = 0 # 외래키 체크 설정 제거 
... 필요 쿼리 수행 (삭제 등등...)
set foreign_key_checks = 1 # 외래키 체크 설정  
```
